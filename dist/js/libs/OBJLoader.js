THREE.OBJLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,n,r){var i=this,s=new THREE.FileLoader(i.manager);s.setPath(this.path),s.load(e,function(e){t(i.parse(e))},n,r)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}var n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():undefined;this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:n!==undefined?n.smooth:this.smooth,groupStart:n!==undefined?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:typeof e=="number"?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){return this.materials.length>0?this.materials[this.materials.length-1]:undefined},_finalize:function(e){var t=this.currentMaterial();t&&t.groupEnd===-1&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1);if(e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),t}};if(n&&n.name&&typeof n.clone=="function"){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){var n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){var n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0]),i.push(r[e+1]),i.push(r[e+2]),i.push(r[t+0]),i.push(r[t+1]),i.push(r[t+2]),i.push(r[n+0]),i.push(r[n+1]),i.push(r[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[e+0]),i.push(r[e+1]),i.push(r[e+2]),i.push(r[t+0]),i.push(r[t+1]),i.push(r[t+2]),i.push(r[n+0]),i.push(r[n+1]),i.push(r[n+2])},addUV:function(e,t,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0]),i.push(r[e+1]),i.push(r[t+0]),i.push(r[t+1]),i.push(r[n+0]),i.push(r[n+1])},addUVLine:function(e){var t=this.uvs,n=this.object.geometry.uvs;n.push(t[e+0]),n.push(t[e+1])},addFace:function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this.vertices.length,p=this.parseVertexIndex(e,h),d=this.parseVertexIndex(t,h),v=this.parseVertexIndex(n,h),m;r===undefined?this.addVertex(p,d,v):(m=this.parseVertexIndex(r,h),this.addVertex(p,d,m),this.addVertex(d,v,m));if(i!==undefined){var g=this.uvs.length;p=this.parseUVIndex(i,g),d=this.parseUVIndex(s,g),v=this.parseUVIndex(o,g),r===undefined?this.addUV(p,d,v):(m=this.parseUVIndex(u,g),this.addUV(p,d,m),this.addUV(d,v,m))}if(a!==undefined){var y=this.normals.length;p=this.parseNormalIndex(a,y),d=a===f?p:this.parseNormalIndex(f,y),v=a===l?p:this.parseNormalIndex(l,y),r===undefined?this.addNormal(p,d,v):(m=this.parseNormalIndex(c,y),this.addNormal(p,d,m),this.addNormal(d,v,m))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";var n=this.vertices.length,r=this.uvs.length;for(var i=0,s=e.length;i<s;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));for(var o=0,s=t.length;o<s;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();e.indexOf("\r\n")!==-1&&(e=e.replace(/\r\n/g,"\n")),e.indexOf("\\\n")!==-1&&(e=e.replace(/\\\n/g,""));var n=e.split("\n"),r="",i="",s="",o=0,u=[],a=typeof "".trimLeft=="function";for(var f=0,l=n.length;f<l;f++){r=n[f],r=a?r.trimLeft():r.trim(),o=r.length;if(o===0)continue;i=r.charAt(0);if(i==="#")continue;if(i==="v"){s=r.charAt(1);if(s===" "&&(u=this.regexp.vertex_pattern.exec(r))!==null)t.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));else if(s==="n"&&(u=this.regexp.normal_pattern.exec(r))!==null)t.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));else{if(s!=="t"||(u=this.regexp.uv_pattern.exec(r))===null)throw new Error("Unexpected vertex/normal/uv line: '"+r+"'");t.uvs.push(parseFloat(u[1]),parseFloat(u[2]))}}else if(i==="f")if((u=this.regexp.face_vertex_uv_normal.exec(r))!==null)t.addFace(u[1],u[4],u[7],u[10],u[2],u[5],u[8],u[11],u[3],u[6],u[9],u[12]);else if((u=this.regexp.face_vertex_uv.exec(r))!==null)t.addFace(u[1],u[3],u[5],u[7],u[2],u[4],u[6],u[8]);else if((u=this.regexp.face_vertex_normal.exec(r))!==null)t.addFace(u[1],u[3],u[5],u[7],undefined,undefined,undefined,undefined,u[2],u[4],u[6],u[8]);else{if((u=this.regexp.face_vertex.exec(r))===null)throw new Error("Unexpected face line: '"+r+"'");t.addFace(u[1],u[2],u[3],u[4])}else if(i==="l"){var c=r.substring(1).trim().split(" "),h=[],p=[];if(r.indexOf("/")===-1)h=c;else for(var d=0,v=c.length;d<v;d++){var m=c[d].split("/");m[0]!==""&&h.push(m[0]),m[1]!==""&&p.push(m[1])}t.addLineGeometry(h,p)}else if((u=this.regexp.object_pattern.exec(r))!==null){var g=(" "+u[0].substr(1).trim()).substr(1);t.startObject(g)}else if(this.regexp.material_use_pattern.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(r))t.materialLibraries.push(r.substring(7).trim());else{if((u=this.regexp.smoothing_pattern.exec(r))===null){if(r==="\0")continue;throw new Error("Unexpected line: '"+r+"'")}var y=u[1].trim().toLowerCase();t.object.smooth=y==="1"||y==="on";var b=t.object.currentMaterial();b&&(b.smooth=t.object.smooth)}}t.finalize();var w=new THREE.Group;w.materialLibraries=[].concat(t.materialLibraries);for(var f=0,l=t.objects.length;f<l;f++){var E=t.objects[f],S=E.geometry,x=E.materials,T=S.type==="Line";if(S.vertices.length===0)continue;var N=new THREE.BufferGeometry;N.addAttribute("position",new THREE.BufferAttribute(new Float32Array(S.vertices),3)),S.normals.length>0?N.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(S.normals),3)):N.computeVertexNormals(),S.uvs.length>0&&N.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(S.uvs),2));var C=[];for(var k=0,L=x.length;k<L;k++){var A=x[k],b=undefined;if(this.materials!==null){b=this.materials.create(A.name);if(T&&b&&!(b instanceof THREE.LineBasicMaterial)){var O=new THREE.LineBasicMaterial;O.copy(b),b=O}}b||(b=T?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,b.name=A.name),b.shading=A.smooth?THREE.SmoothShading:THREE.FlatShading,C.push(b)}var M;if(C.length>1){for(var k=0,L=x.length;k<L;k++){var A=x[k];N.addGroup(A.groupStart,A.groupCount,k)}M=T?new THREE.LineSegments(N,C):new THREE.Mesh(N,C)}else M=T?new THREE.LineSegments(N,C[0]):new THREE.Mesh(N,C[0]);M.name=E.name,w.add(M)}return console.timeEnd("OBJLoader"),w}};